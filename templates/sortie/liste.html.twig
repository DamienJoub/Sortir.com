{% extends 'base.html.twig' %}

{% block main %}

    <div class="jumbotron jumbotron-fluid bg-transparent" style="margin-top: -50px; border-bottom: 1px solid #D3D3D3; padding-bottom: 0px;">
        <div class="container">
            <h1 class="display-7">Filtrer les sorties</h1>

            <form method="post" action="{{ path('sortie_filtre') }}" {#onSubmit="return listeSorties(event)"#}>
                <div class="row">
                    <div class="col-sm-6">
                        <label for="listeCampus">Site</label>
                        <select class="browser-default custom-select" id="listeCampus" name="campus">
                            <option selected="true" disabled="disabled">Choisissez un campus</option>
                            {% for unCampus in campus %}
                                <option value="{{ unCampus.id }}">{{ unCampus.nom }}</option>
                            {% endfor %}
                        </select>

                        <label for="searchInput">Le nom de la sortie contient</label>
                        <input id="searchInput" class="form-control" type="text" placeholder="Rechercher" name ="search">

                        <div class="flex-sm-row">
                            <label for="dateDebut">Entre le</label>
                            <input id="dateDebut" name="dateDebut" type="text" class="js-datepicker form-control">
                            <label for="dateFin">Et le</label>
                            <input id="dateFin" name="dateFin" type="text" class="js-datepicker form-control">
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="flex-row">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="organisateur" name="organisateur"/>
                                <label for="organisateur" class="custom-control-label">Sorties dont je suis l'oganisateur/trice</label>
                            </div>
                        </div>
                        <div class="flex-row">&nbsp;</div>
                        <div class="flex-row">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="inscrit" name="inscrit"/>
                                <label for="inscrit" class="custom-control-label">Sorties auxquelles je suis inscrit/e</label>
                            </div>
                        </div>
                        <div class="flex-row">&nbsp;</div>
                        <div class="flex-row">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="nonInscrit" name="nonInscrit"/>
                                <label for="nonInscrit" class="custom-control-label">Sorties auxquelles je ne suis pas inscrit/e</label>
                            </div>
                        </div>
                        <div class="flex-row">&nbsp;</div>
                        <div class="flex-row">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="passee" name="passee"/>
                                <label for="passee" class="custom-control-label">Sorties pass&eacute;es</label>
                            </div>
                        </div>
                        <div class="flex-row">&nbsp;</div>
                        <button type="submit" class="btn btn-outline-primary btn-lg">Rechercher</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div>
        <table id="tableauSorties" class="table table-bordered table-condensed table-body-center" >
            <thead>
            <tr>
                <th>Nom de la sortie</th>
                <th>Date de la sortie</th>
                <th class="list-desktop">Clôture</th>
                <th class="list-desktop">Inscrits/Places</th>
                <th class="list-desktop">&Eacute;tat</th>
                <th class="list-desktop">Inscrit</th>
                <th class="list-desktop">Organisateur</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for sortie in sorties %}
                {% if app.user.administrateur or sortie.dateDebut|date_modify("+1 month") > "now"|date("Y/m/d")  and (
                    sortie.etat.libelle != "Créée" or(
                    sortie.participantO == app.user and sortie.etat.libelle == "Créée"))%}
                    <tr>
                        <td>{{sortie.nom}}</td>
                        <td>{{sortie.dateDebut | date('d/m/Y H:i')}}</td>
                        <td class="list-desktop">{{sortie.dateCloture | date('d/m/Y H:i')}}</td>
                        <td class="list-desktop">
                            {% if sortie.etat.libelle != "Annulée" %}
                                {{sortie.participantsP | length}}/{{sortie.nbInscriptionMax}}
                            {% else %}
                                 -/-
                            {% endif %}
                        </td>
                        <td class="list-desktop">{{sortie.etat.libelle}}</td>
                        {% if sortie in isInscrit %}
                            <td style="text-align: center" class="list-desktop"><img src="{{ asset('img/check.png') }}"></td>
                        {% else %}
                            <td class="list-desktop"> </td>
                        {% endif %}
                        <td class="list-desktop"><u><a href="{{ path("profil", {'id':sortie.ParticipantO.id} ) }}">{{sortie.ParticipantO.prenom}} {{sortie.ParticipantO.nom | upper}}</a></u></td>
                        <td>
                            <u><a href="{{ path("sortie_detail", {'id':sortie.id}) }}">Afficher</a></u>
                            {% if  app.user in sortie.participantsP and sortie.etat.libelle == "Ouverte"%}
                                - <u><a href="{{ path("sortie_desinscription", {'id':sortie.id}) }}">Se d&eacute;sister</a></u>
                            {% endif %}
                            {% if app.user not in sortie.participantsP and sortie.etat.libelle == "Ouverte" and sortie.NbInscriptionMax > sortie.ParticipantsP|length %}
                                - <u><a href="{{ path("sortie_inscription", {'id':sortie.id}) }}">S'inscrire</a></u>
                            {% endif %}
                            {% if (app.user.administrateur or app.user == sortie.participantO) and ( sortie.etat.libelle == "Ouverte" or sortie.etat.libelle == "Créée") and sortie.dateDebut > "now"|date("Y/m/d") %}
                                <u><a href="{{ path("sortie_modifier", {'id':sortie.id}) }}">Modifier</a></u>
                                - <u><a href="{{ path("sortie_annuler", {'id':sortie.id}) }}" >Annuler</a></u>
                            {% endif %}
                            {% if (app.user.administrateur or app.user == sortie.participantO) and sortie.etat.libelle == "Créée" %}
                                - <u><a href="{{ path("sortie_publication", {'id':sortie.id}) }}">Publier</a></u>
                            {% endif %}
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
        <a href="{{ path("sortie_creer") }}"><button class="btn btn-primary">Cr&eacute;er une sortie</button></a>
    </div>
{% endblock %}